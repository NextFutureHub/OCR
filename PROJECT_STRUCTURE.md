# Структура проекта OCR Quality Assessment API

## Обзор проекта

Система оценки качества OCR с использованием EasyOCR и FastAPI, реализующая все требования по техническим критериям.

## Структура файлов

```
OCR/
├── main.py                    # Основной FastAPI сервер
├── run_server.py             # Скрипт запуска сервера
├── config.py                 # Конфигурация приложения
├── requirements.txt          # Зависимости Python
├── README.md                 # Основная документация
├── INSTALL.md                # Инструкция по установке
├── PROJECT_STRUCTURE.md      # Этот файл
│
├── ocr_service.py            # Сервис OCR с EasyOCR
├── metrics_calculator.py     # Расчет метрик качества
├── data_extractor.py         # Извлечение структурированных данных
├── noise_handler.py          # Обработка зашумленных изображений
│
├── test_api.py               # Тестирование API
├── examples.py               # Примеры использования
├── demo.py                   # Демонстрация работы системы
│
└── client/                   # Frontend приложение (Next.js)
    ├── src/
    ├── package.json
    └── ...
```

## Описание модулей

### Основные модули

#### `main.py`
- **Назначение**: Основной FastAPI сервер
- **Функции**:
  - API endpoints для обработки документов
  - Интеграция всех сервисов
  - Обработка HTTP запросов
  - CORS настройки

#### `ocr_service.py`
- **Назначение**: Сервис OCR с EasyOCR
- **Функции**:
  - Извлечение текста из изображений
  - Предобработка изображений
  - Поддержка множественных языков
  - Обработка уверенности распознавания

#### `metrics_calculator.py`
- **Назначение**: Расчет метрик качества OCR
- **Функции**:
  - CER (Character Error Rate)
  - WER (Word Error Rate)
  - Normalized Levenshtein Distance
  - Precision, Recall, F1-score
  - Метрики на уровне полей

#### `data_extractor.py`
- **Назначение**: Извлечение структурированных данных
- **Функции**:
  - Извлечение полей по паттернам
  - Валидация JSON
  - Проверка соответствия схеме
  - Нормализация данных

#### `noise_handler.py`
- **Назначение**: Обработка зашумленных изображений
- **Функции**:
  - Удаление различных типов шума
  - Улучшение качества изображений
  - Определение уровня шума
  - Морфологические операции

### Конфигурация

#### `config.py`
- **Назначение**: Централизованная конфигурация
- **Содержит**:
  - Настройки сервера
  - Параметры OCR
  - Схемы валидации
  - Паттерны извлечения полей

### Тестирование и демонстрация

#### `test_api.py`
- **Назначение**: Тестирование API
- **Функции**:
  - Проверка всех endpoints
  - Тестирование метрик
  - Валидация ответов

#### `examples.py`
- **Назначение**: Примеры использования
- **Содержит**:
  - Базовые примеры
  - Обработка ошибок
  - Пакетная обработка
  - Валидация данных

#### `demo.py`
- **Назначение**: Демонстрация работы системы
- **Функции**:
  - Интерактивная демонстрация
  - Визуализация метрик
  - Сравнение качества

## API Endpoints

### Основные endpoints

| Endpoint | Метод | Описание |
|----------|-------|----------|
| `/ocr/process` | POST | Обработка документа с OCR |
| `/ocr/batch-process` | POST | Пакетная обработка |
| `/metrics/calculate` | POST | Расчет метрик качества |
| `/noise/process` | POST | Обработка зашумленных данных |
| `/health` | GET | Проверка состояния |

### Параметры запросов

#### POST `/ocr/process`
```json
{
  "file": "multipart/form-data",
  "ground_truth": "string (optional)",
  "expected_fields": "array (optional)",
  "schema": "object (optional)"
}
```

#### POST `/metrics/calculate`
```json
{
  "extracted_text": "string",
  "ground_truth": "string",
  "expected_fields": "array (optional)"
}
```

## Метрики качества

### Технические метрики (70 баллов)

#### Точность OCR (25 баллов)
- **CER**: `(S + D + I) / N`
- **WER**: `(S + D + I) / N`
- **Normalized Levenshtein**: `distance / max_length`

#### Извлечение данных (25 баллов)
- **Field-level Accuracy**: Точность каждого поля
- **F1-score**: Для каждого поля
- **Exact Match**: Процент полностью верных документов

#### Работа с шумом (10 баллов)
- **CER/WER на noisy subset**
- Автоматическая очистка изображений
- Определение уровня шума

#### Структурированность (10 баллов)
- **JSON Validity**: Процент корректных JSON
- **Schema Consistency**: Процент JSON с обязательными ключами

## Поддерживаемые поля

| Поле | Паттерн | Пример |
|------|---------|--------|
| `name` | ФИО, имя | "Иван Иванов" |
| `date` | Дата | "01.01.2023" |
| `phone` | Телефон | "+7(999)123-45-67" |
| `email` | Email | "user@example.com" |
| `address` | Адрес | "г. Москва, ул. Ленина, 1" |
| `passport` | Паспорт | "1234 567890" |
| `inn` | ИНН | "1234567890" |
| `amount` | Сумма | "100000" |

## Зависимости

### Основные библиотеки
- `fastapi`: Web framework
- `easyocr`: OCR engine
- `opencv-python`: Обработка изображений
- `numpy`: Численные вычисления
- `scikit-learn`: Метрики машинного обучения
- `python-levenshtein`: Расстояние Левенштейна
- `jsonschema`: Валидация JSON схем

### Дополнительные библиотеки
- `uvicorn`: ASGI сервер
- `pydantic`: Валидация данных
- `pillow`: Обработка изображений
- `pandas`: Анализ данных

## Запуск проекта

### 1. Установка зависимостей
```bash
pip install -r requirements.txt
```

### 2. Запуск сервера
```bash
python run_server.py
```

### 3. Тестирование
```bash
python test_api.py
```

### 4. Демонстрация
```bash
python demo.py
```

## Конфигурация

### Переменные окружения
- `DEBUG`: Режим отладки
- `HOST`: Хост сервера
- `PORT`: Порт сервера
- `OCR_LANGUAGES`: Языки OCR
- `OCR_GPU_ENABLED`: Использование GPU
- `MAX_IMAGE_SIZE`: Максимальный размер изображения

### Настройки в config.py
- Языки распознавания
- Паттерны извлечения полей
- Схемы валидации
- Параметры обработки шума

## Производительность

### Оптимизации
- Кэширование моделей OCR
- Параллельная обработка
- Оптимизация изображений
- Использование GPU

### Масштабирование
- Горизонтальное масштабирование
- Балансировка нагрузки
- Кэширование результатов
- Асинхронная обработка

## Мониторинг

### Логирование
- Файл логов: `ocr_api.log`
- Уровни логирования: DEBUG, INFO, WARNING, ERROR
- Структурированные логи

### Метрики
- Время обработки
- Точность OCR
- Качество извлечения данных
- Статистика ошибок

## Безопасность

### Валидация
- Проверка типов файлов
- Ограничение размера файлов
- Валидация входных данных
- Санитизация данных

### CORS
- Настройка CORS политик
- Ограничение доменов
- Безопасные заголовки

## Расширяемость

### Добавление новых полей
1. Добавить паттерн в `config.py`
2. Обновить `data_extractor.py`
3. Добавить валидацию в схему

### Добавление новых метрик
1. Реализовать в `metrics_calculator.py`
2. Добавить в API endpoint
3. Обновить документацию

### Добавление новых языков
1. Обновить `OCR_LANGUAGES` в конфигурации
2. Перезапустить сервер
3. EasyOCR автоматически загрузит модели

## Лицензия

MIT License - свободное использование и модификация.
